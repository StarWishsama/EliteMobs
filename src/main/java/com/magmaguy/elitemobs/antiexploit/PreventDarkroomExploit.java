package com.magmaguy.elitemobs.antiexploit;

import com.magmaguy.elitemobs.api.EliteMobDamageEvent;
import com.magmaguy.elitemobs.config.AntiExploitConfig;
import com.magmaguy.elitemobs.utils.NonSolidBlockTypes;
import org.bukkit.Location;
import org.bukkit.Material;
import org.bukkit.entity.LivingEntity;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.util.Vector;

public class PreventDarkroomExploit implements Listener {

    @EventHandler
    public void onDamage(EliteMobDamageEvent event) {

        Location entityLocation = event.getEntity().getLocation().getBlock().getLocation().add(0.5, 0, 0.5);

        Material block0a = entityLocation.clone().add(new Vector(0, 0, 1)).getBlock().getType();
        Material block1a = entityLocation.clone().add(new Vector(0, 1, 1)).getBlock().getType();

        Material block0b = entityLocation.clone().add(new Vector(1, 0, 0)).getBlock().getType();
        Material block1b = entityLocation.clone().add(new Vector(1, 1, 0)).getBlock().getType();

        Material block0c = entityLocation.clone().add(new Vector(0, 0, -1)).getBlock().getType();
        Material block1c = entityLocation.clone().add(new Vector(0, 1, -1)).getBlock().getType();

        Material block0d = entityLocation.clone().add(new Vector(-1, 0, 0)).getBlock().getType();
        Material block1d = entityLocation.clone().add(new Vector(-1, 1, 0)).getBlock().getType();

        Material topBlock = entityLocation.clone().add(new Vector(0, 2, 0)).getBlock().getType();

        //gets blocks at 1 height completely surrounding the entity
        if (AntiExploitConfig.darkroomAntiexploit1)
            if (!NonSolidBlockTypes.isNonSolidBlock(block1a) &&
                    !NonSolidBlockTypes.isNonSolidBlock(block1b) &&
                    !NonSolidBlockTypes.isNonSolidBlock(block1c) &&
                    !NonSolidBlockTypes.isNonSolidBlock(block1d)) {
                event.getEliteMobEntity().setHasSpecialLoot(false);
                AntiExploitMessage.sendWarning((LivingEntity) event.getEntity(), "darkroom 1");
                return;
            }

        //gets blocks at 0 height plus if there's a block on top
        if (AntiExploitConfig.darkroomAntiexploit2)
            if ((!NonSolidBlockTypes.isNonSolidBlock(block0a) || !NonSolidBlockTypes.isNonSolidBlock(block1a)) &&
                    (!NonSolidBlockTypes.isNonSolidBlock(block0b) || !NonSolidBlockTypes.isNonSolidBlock(block1b)) &&
                    (!NonSolidBlockTypes.isNonSolidBlock(block0c) || !NonSolidBlockTypes.isNonSolidBlock(block1c)) &&
                    (!NonSolidBlockTypes.isNonSolidBlock(block0d) || !NonSolidBlockTypes.isNonSolidBlock(block0d)) &&
                    !NonSolidBlockTypes.isNonSolidBlock(topBlock)) {
                event.getEliteMobEntity().setHasSpecialLoot(false);
                AntiExploitMessage.sendWarning((LivingEntity) event.getEntity(), "darkroom 2");
                return;
            }

    }

}
